---
aliases:
  - фильтр Калмана
---

# Фильтр Калмана. Расширенный фильтр Калмана.

![[Pasted image 20240526151833.png]]

![https://www.youtube.com/watch?v=J3MOouYM8wM&t=313s&ab_channel=NoML](https://www.youtube.com/watch?v=J3MOouYM8wM&t=313s&ab_channel=NoML)
### Фильтр Калмана

Фильтр Калмана — это алгоритм, который использует последовательные измерения наблюдений, содержащих случайные шумы и неточности, для оценки истинных значений переменных. Он используется в системах управления и навигации, робототехнике и других областях, где необходимо получать наилучшие оценки состояния системы на основе неполных и шумных данных.

#### Основные шаги фильтра Калмана

1. **Предсказание (Prediction):**
   - **Предсказание состояния:**
     $\hat{x}_{k|k-1} = A_{k-1} \hat{x}_{k-1|k-1} + B_{k-1} u_{k-1}$
     где $\hat{x}_{k|k-1}$ — предсказанное состояние в момент времени $k$, $A_{k-1}$ — матрица перехода состояния, $\hat{x}_{k-1|k-1}$ — оценка состояния в момент времени $k-1$, $B_{k-1}$ — матрица управления, $u_{k-1}$ — вектор управления.
   - **Предсказание ковариации ошибки:**
     $P_{k|k-1} = A_{k-1} P_{k-1|k-1} A_{k-1}^T + Q_{k-1}$
     где $P_{k|k-1}$ — предсказанная ковариация ошибки, $P_{k-1|k-1}$ — ковариация ошибки в момент времени $k-1$, $Q_{k-1}$ — ковариация шума процесса.

2. **Обновление (Update):**
   - **Вычисление ошибки измерения:**
     $y_k = z_k - H_k \hat{x}_{k|k-1}$
     где $y_k$ — инновация или ошибка измерения, $z_k$ — измерение, $H_k$ — матрица наблюдения.
   - **Вычисление ковариации ошибки измерения:**
     $S_k = H_k P_{k|k-1} H_k^T + R_k$
     где $S_k$ — ковариация инновации, $R_k$ — ковариация шума измерения.
   - **Вычисление коэффициента Калмана:**
     $K_k = P_{k|k-1} H_k^T S_k^{-1}$
     где $K_k$ — коэффициент Калмана.
   - **Обновление оценки состояния:**
     $\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k y_k$
   - **Обновление ковариации ошибки:**
     $P_{k|k} = (I - K_k H_k) P_{k|k-1}$

### Расширенный фильтр Калмана (EKF)

Расширенный фильтр Калмана (EKF) используется для нелинейных систем. Он аппроксимирует нелинейные функции, используя разложение в ряд Тейлора.

#### Основные шаги расширенного фильтра Калмана

1. **Предсказание (Prediction):**
   - **Предсказание состояния:**
     $\hat{x}_{k|k-1} = f(\hat{x}_{k-1|k-1}, u_{k-1})$
     где $f(\cdot)$ — нелинейная функция перехода состояния.
   - **Предсказание ковариации ошибки:**
     $P_{k|k-1} = F_{k-1} P_{k-1|k-1} F_{k-1}^T + Q_{k-1}$
     где $F_{k-1} = \frac{\partial f}{\partial x}\big|_{\hat{x}_{k-1|k-1}, u_{k-1}}$ — якобиан функции перехода состояния.

2. **Обновление (Update):**
   - **Вычисление ошибки измерения:**
     $y_k = z_k - h(\hat{x}_{k|k-1})$
     где $h(\cdot)$ — нелинейная функция наблюдения.
   - **Вычисление ковариации ошибки измерения:**
     $S_k = H_k P_{k|k-1} H_k^T + R_k$
     где $H_k = \frac{\partial h}{\partial x}\big|_{\hat{x}_{k|k-1}}$ — якобиан функции наблюдения.
   - **Вычисление коэффициента Калмана:**
     $K_k = P_{k|k-1} H_k^T S_k^{-1}$
   - **Обновление оценки состояния:**
     $\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k y_k$
   - **Обновление ковариации ошибки:**
     $P_{k|k} = (I - K_k H_k) P_{k|k-1}$

### Пример

Рассмотрим пример использования фильтра Калмана для отслеживания положения и скорости объекта, движущегося по прямой линии.

#### Определения и данные

- Положение и скорость объекта: $x = \begin{pmatrix} \text{положение} \\ \text{скорость} \end{pmatrix}$
- Измерения: $z = \text{положение}$
- Переходное состояние:
  $A = \begin{pmatrix} 1 & \Delta t \\ 0 & 1 \end{pmatrix}$
  где $\Delta t$ — шаг времени.
- Матрица наблюдения:
  $H = \begin{pmatrix} 1 & 0 \end{pmatrix}$
- Матрица управления и вектор управления отсутствуют ($B = 0$ и $u = 0$).
- Ковариации шумов процесса и измерения: $Q$ и $R$.

#### Шаги фильтра Калмана

1. **Предсказание:**
   $\hat{x}_{k|k-1} = A \hat{x}_{k-1|k-1}$
   
   $P_{k|k-1} = A P_{k-1|k-1} A^T + Q$

2. **Обновление:**
   $y_k = z_k - H \hat{x}_{k|k-1}$
   
   $S_k = H P_{k|k-1} H^T + R$
   
   $K_k = P_{k|k-1} H^T S_k^{-1}$
   
   $\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k y_k$
   
   $P_{k|k} = (I - K_k H) P_{k|k-1}$

### Заключение

Фильтр Калмана и его расширенный вариант (EKF) являются мощными инструментами для оценки состояния динамических систем в условиях шума и неточностей измерений. Они широко применяются в навигации, управлении беспилотными транспортными средствами, робототехнике и других областях.