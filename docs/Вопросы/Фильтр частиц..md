# Фильтр частиц.

### Фильтр частиц

Фильтр частиц — это вероятностный метод, используемый для оценки состояния динамических систем, в которых нелинейности и/или ненормальности мешают применению традиционных методов, таких как фильтр Калмана. Он основан на использовании множества "частиц" для аппроксимации апостериорного распределения состояния системы.

### Основные концепции

1. **Частицы**
   - Частицы представляют собой возможные состояния системы и ассоциированные с ними веса.
   - Каждая частица — это гипотеза о текущем состоянии системы.

2. **Алгоритм фильтра частиц**
   - **Инициализация**: Создание и инициализация множества частиц.
   - **Предсказание**: Обновление состояний частиц на основе динамической модели системы.
   - **Обновление весов**: Изменение весов частиц на основе наблюдений.
   - **Ресемплирование**: Замена частиц с малыми весами частицами с большими весами, чтобы избежать вырождения частиц.

### Шаги алгоритма фильтра частиц

1. **Инициализация**

   Инициализация $N$ частиц $\{x_0^{(i)}, w_0^{(i)}\}_{i=1}^N$, где $x_0^{(i)}$ — начальное состояние $i$-й частицы, а $w_0^{(i)} = \dfrac{1}{N}$ — её вес.

2. **Предсказание**

   Для каждого момента времени $k$ обновляется состояние частиц согласно модели динамики:
   
   $x_k^{(i)} = f(x_{k-1}^{(i)}, u_{k-1}) + w_{k-1}^{(i)}$
   
   где $f$ — функция перехода, $u_{k-1}$ — управляющее воздействие, $w_{k-1}^{(i)}$ — шум процесса.

3. **Обновление весов**

   Вес частицы обновляется на основе наблюдений:
   $w_k^{(i)} \propto w_{k-1}^{(i)} \cdot p(z_k | x_k^{(i)})$
   где $p(z_k | x_k^{(i)})$ — вероятность наблюдения $z_k$, учитывая состояние частицы $x_k^{(i)}$.

4. **Нормализация весов**

   Нормализуем веса частиц, чтобы их сумма равнялась 1:
   $w_k^{(i)} = \dfrac{w_k^{(i)}}{\sum_{j=1}^N w_k^{(j)}}$

5. **Ресемплирование**

   Если веса частиц сильно разнятся, то проводится ресемплирование. Частицы с малыми весами заменяются на частицы с большими весами, чтобы сохранить численную стабильность:
   $\{x_k^{(i)}\}_{i=1}^N \sim \{x_k^{(i)}, w_k^{(i)}\}_{i=1}^N$
   После ресемплирования веса частиц устанавливаются равными: $w_k^{(i)} = \dfrac{1}{N}$.

### Пример применения фильтра частиц

Рассмотрим задачу отслеживания положения и скорости объекта, движущегося по прямой, с использованием фильтра частиц.

**Описание задачи:**
- Объект движется с постоянной скоростью.
- Измерения положения объекта подвержены случайным ошибкам.

**Модель системы:**
- Состояние объекта включает положение и скорость: $x_k = \begin{pmatrix} p_k \\ v_k \end{pmatrix}$.
- Модель динамики: $f(x_{k-1}, u_{k-1}) = \begin{pmatrix} p_{k-1} + \Delta t \cdot v_{k-1} \\ v_{k-1} \end{pmatrix}$.
- Шум процесса: $w_k \sim \mathcal{N}(0, Q)$, где $Q$ — ковариация шума процесса.

**Модель измерений:**
- Измеряется только положение объекта: $z_k = p_k + v_k$.
- Шум измерения: $v_k \sim \mathcal{Н}(0, R)$, где $R$ — дисперсия шума измерения.

### Реализация фильтра частиц

1. **Инициализация:**
   - Создание $N$ частиц $\{x_0^{(i)}, w_0^{(i)}\}_{i=1}^N$, где $x_0^{(i)} \sim p(x_0)$ и $w_0^{(i)} = \dfrac{1}{N}$.

2. **Предсказание:**
   $x_k^{(i)} = F x_{k-1}^{(i)} + w_{k-1}^{(i)}$
   где $F = \begin{pmatrix} 1 & \Delta t \\ 0 & 1 \end{pmatrix}$.

3. **Обновление весов:**
   $w_k^{(i)} \propto w_{k-1}^{(i)} \cdot \exp\left(-\dfrac{(z_k - H x_k^{(i)})^2}{2R}\right)$
   где $H = \begin{pmatrix} 1 & 0 \end{pmatrix}$.

4. **Нормализация весов:**
   $w_k^{(i)} = \dfrac{w_k^{(i)}}{\sum_{j=1}^N w_k^{(j)}}$

5. **Ресемплирование:**
   - Если эффективное число частиц $N_{\text{eff}} = \dfrac{1}{\sum_{i=1}^N (w_k^{(i)})^2}$ меньше заданного порога, выполняется ресемплирование.
   - Новые частицы выбираются с вероятностью, пропорциональной их весам.

### Заключение

Фильтр частиц предоставляет мощный инструмент для оценки состояния динамических систем, особенно в условиях нелинейности и ненормальности. Он широко применяется в задачах робототехники, навигации, компьютерного зрения и других областях, где традиционные методы оценки состояния могут быть неэффективны.